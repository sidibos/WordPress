<?php
/**
 * Provides a bootstrap file to set up a lightbox display function
 * and then call it. Including this file in another page's source
 * will show the lightbox as requested.
 *
 * Takes a request parameter: s - Forwarded to the prefslightbox by
 * way of "?set"
 *
 * @copyright The Financial Times Limited [All Rights Reserved]
 */

require_once($_SERVER['DOCUMENT_ROOT'].'/../helpers/cacheability/cacheability');
Cacheability::setVarnishExpiryTime(7200);
Cacheability::setExternalExpiryTime(7200);
Cacheability::outputHeaders();

header("Content-type: text/javascript");

?>

function AssankaAuth_UpdateProfileInLightbox(profileset, force) {
	var aa_db = document.body;
	var aa_de = document.documentElement;
	if (document.getElementById('assankaauth_updprofilebox')) return;
	var cburl = location.href;

	var aa_ww = (window.innerWidth) ? window.innerWidth : ((aa_de && aa_de.clientWidth) ? aa_de.clientWidth : aa_db.clientWidth );
	var aa_wh = (window.innerHeight) ? window.innerHeight : ((aa_de && aa_de.clientHeight) ? aa_de.clientHeight : aa_db.clientHeight );
	var aa_sy = (window.pageYOffset) ? window.pageYOffset : ((aa_de && aa_de.scrollTop) ? aa_de.scrollTop : aa_db.scrollTop);
	var aa_sx = (window.pageXOffset) ? window.pageXOffset : ((aa_de && aa_de.scrollLeft) ? aa_de.scrollLeft : aa_db.scrollLeft);
	var aa_targetx = aa_sx + Math.max((aa_ww - 420)/2, 10);
	var aa_targety = aa_sy + Math.max((aa_wh - 230)/2, 10);

	var popuphtml = '<div style="position: absolute; z-index: 1500; left: '+aa_targetx+'px; top: '+aa_targety+'px; background: url(http://media.ft.com/img/shadow-9x9.png); padding: 11px;"><div style="background-color: white; padding: 10px; text-align: right;"><a href="javascript:var ele=document.getElementById(\'assankaauth_updprofilebox\'); ele.parentNode.removeChild(ele); void(0)" style="height: 12px; width: 12px;"><img src="http://media.ft.com/img/menu_close.gif" width="12" height="12" alt="Close" /></a><iframe id="assankaauth_iframe" src="" width="400" height="210" frameborder="0" marginheight="0" marginwidth="0" style="display: block; padding: 0; margin: 0; border: none; overflow: hidden;"></iframe></div></div>';
	var containerdiv = document.createElement('div');
	containerdiv.id = 'assankaauth_updprofilebox';
	containerdiv.innerHTML = popuphtml;
	aa_db.appendChild(containerdiv);
	window.setTimeout(function() { document.getElementById('assankaauth_iframe').src = 'http://<?php echo $_SERVER['HTTP_HOST']; ?>/auth/prefslightbox/?set='+encodeURIComponent(profileset)+'&force='+force+'&returnurl='+encodeURIComponent(cburl); }, 10);
}

AssankaAuth_UpdateProfileInLightbox('<?php if (!empty($_GET['s'])) echo $_GET['s']; ?>', <?php echo (!empty($_GET['force'])) ? '1' : '0';  ?>);