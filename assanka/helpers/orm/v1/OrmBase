<?php
/**
 * Generic object class - provides access to databases
 *
 * @codingstandard ftlabs-phpcs
 * @copyright The Financial Times Limited [All Rights Reserved]
 */

require_once $_SERVER['CORE_PATH']."/helpers/memcache/v1/memcacheaccess";

abstract class OrmBaseV1 {

	protected static $dbread, $dbwrite;

	public static function initDB($read, $write) {
		self::$dbread = &$read;
		self::$dbwrite = &$write;
	}

	public static function useMasterDB() {
		self::$dbread = self::$dbwrite;
	}

	protected static function sqlPlaceholder($key, $mod=false) {
		$sql = "{".$key;
		if ($mod) {
			$sql .= "|".$mod;
		} elseif (isset(static::$fields[$key])) {
			$def = static::$fields[$key];
			if (in_array($def['type'], array('date', 'datetime', 'datetimeseconds', 'time', 'timeseconds'))) {
				$sql .= "|date";
			} elseif (in_array($def['type'], array('text', 'textarea'))) {
				$sql .= "|string";
			} elseif ($def['type'] == 'boolean') {
				$sql .= "|01";
			}
		}
		$sql .= "}";
		return $sql;
	}

	protected static function dbread() {
		return self::$dbread;
	}

	protected static function dbwrite() {
		return self::$dbwrite;
	}

	protected static function getMemcache() {
		return MemcacheAccess::getMemcache();
	}
}

if (!class_exists('OrmBase')) class_alias('OrmBaseV1', 'OrmBase');
