<?php
require_once("../appglobal");




// This file is deprecated, and should no longer be in use.  This error designed to catch cases where it is still being used.
trigger_error('Deprecated code in use', E_USER_DEPRECATED);




$request = $sdb->queryRow("SELECT title, client, project FROM requests WHERE {id}", $_GET);
if (!$request) exit("Request not found");

// Get permission levels before proceeding, to check whether the user has the authority to view logs for this project
$isdeveloper = $sdb->queryRow("SELECT isdeveloper FROM permissions WHERE userid=".$_SESSION["support"]["userid"]." AND ((client='".$request["client"]."' AND project='".$request["project"]."') OR (client='".$request["client"]."' AND project IS NULL) OR (client IS NULL AND project IS NULL)) ORDER BY (project IS NOT NULL AND client IS NOT NULL) DESC, (client IS NOT NULL) DESC LIMIT 1");

if (!$isdeveloper) exit("Sorry, you do not have permission to view debug logs");

// Load first debug log ID
$logid = $sdb->querySingle("SELECT id FROM debuglogs WHERE requestid=".$_GET["id"]." ORDER BY occurencedate LIMIT 1");
if (!$logid) exit('There are no debug logs for this support request');

?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title><?=$request["title"]?>: Debug logs</title>
</head>
<frameset cols="140,*">
	<frame name="list" src="list?id=<?php echo $_GET['id'] ?>&did=<?php echo $logid ?>" frameborder='0' noresize='noresize' />
	<frame name="logview" src="logview?id=<?php echo $logid ?>" frameborder='0' noresize='noresize' />
</frameset>
</html>