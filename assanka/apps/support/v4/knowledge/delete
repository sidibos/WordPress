<?php
require_once("../appglobal");



// This file is deprecated, and should no longer be in use.  This error designed to catch cases where it is still being used.
trigger_error('Deprecated code in use', E_USER_DEPRECATED);





$kb = $sdb->queryRow("SELECT * FROM knowledge WHERE {id}", $_POST);
if (!$kb) $page->redirectAndAlert("Could not find that knowledge item");

// Ensure current user has permission to edit
$isdeveloper = $sdb->queryRow("SELECT isdeveloper FROM permissions WHERE userid=".$_SESSION["support"]["userid"]." AND ((client='".$kb["client"]."' AND project='".$kb["project"]."') OR (client='".$kb["client"]."' AND project IS NULL) OR (client IS NULL AND project IS NULL)) ORDER BY (project IS NOT NULL AND client IS NOT NULL) DESC, (client IS NOT NULL) DESC LIMIT 1");

if ($isdeveloper) {

	// Do the deletion
	$sdb->query("DELETE FROM knowledge WHERE id=".$_POST["id"]);
	$page->alert("Knowledge item deleted","done");
} else {
	$page->alert("You don't have permission to delete that knowledge item","done");
}

$page->redirect("knowledge/");
?>