<?php
/*
######################################################################
$RCSfile$
$Revision$
$Date$
$Author$

PHPUnit test for the ErrorHandlerV5

(c) Copyright Assanka Limited [All rights reserved]
######################################################################
*/

// Include the template manager
require_once($_SERVER['CORE_PATH']."/helpers/errorhandler/v5/errorhandler");


class TestClass {
	private $_testarray;
	
	function __construct() {
		$this->_testarray = array('a' => array(1));
		$this->_testarray['b'] = &$this->_testarray['a'];
	}
	
	function getVal() {
		return json_encode($this->_testarray);
	}
}		
		
class templateManagerTest extends PHPUnit_Framework_TestCase {

	/**
	 * Test that the error handler doesn't pollute classes.
	 */
	public function testPolluteClasses() {

		$test = new TestClass();
		$unpolluted = $test->getVal();
		
		// Typically in a live environment, E_USER_NOTICE messages are logged but not stopped.
		ErrorHandler::init();
		ErrorHandler::removeActionTrigger('stop', E_USER_NOTICE);
		ErrorHandler::addActionTrigger('log', E_USER_NOTICE);

		trigger_error('Dummy error', E_USER_NOTICE);

		$potentiallypolluted = $test->getVal();
		$this->assertEquals($unpolluted, $potentiallypolluted);
	}
}
