<?php
/**
 * Ormv2 Test Suite
 *
 * @copyright The Financial Times Limited [All rights reserved]
 */

define('MOCK_DIR', dirname(__FILE__).'/mock/');

class Ormv2TestSuite extends PHPUnit_Framework_TestSuite {

	private $conn;

	public static function suite() {
        $suite = new Ormv2TestSuite();

		$dir = dirname(__FILE__);

		$suite->addTestFiles(array(
			$dir.'/ActiveRecordTest',
			$dir.'/SingletonTest'
		));

		return $suite;
    }

    protected function setUp() {


		if (empty($_SERVER['DB_HOST'])) $_SERVER['DB_HOST'] = 'localhost';
		if (empty($_SERVER['DB_USER'])) $_SERVER['DB_USER'] = 'test';
		if (empty($_SERVER['DB_PASS'])) $_SERVER['DB_PASS'] = 'test';
		if (empty($_SERVER['DB_NAME'])) $_SERVER['DB_NAME'] = 'test_core_ormv2';


		$this->conn = mysql_connect($_SERVER['DB_HOST'], $_SERVER['DB_USER'], $_SERVER['DB_PASS'], true, 128);
		if (!$this->conn) throw new Exception("Can't connect to test db");
		mysql_select_db($_SERVER['DB_NAME'], $this->conn);
		mysql_query("DROP DATABASE IF EXISTS {$_SERVER['DB_NAME']}", $this->conn);
		mysql_query("CREATE DATABASE {$_SERVER['DB_NAME']} CHARACTER SET 'utf8' COLLATE 'utf8_bin'", $this->conn);

    }

    protected function tearDown() {
		mysql_query("DROP DATABASE {$_SERVER['DB_NAME']}", $this->conn);
    }
}
